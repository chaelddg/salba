<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <link rel="stylesheet" type="text/css" href="/lib/foundation/css/foundation.css">
    <link rel="stylesheet" type="text/css" href="/lib/foundation-icon-fonts/foundation-icons.css">
    <link rel="stylesheet" type="text/css" href="/lib/datatable/media/css/jquery.dataTables.css">
</head>
<body>

  <div class="off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">
      <nav class="tab-bar">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon"><span></span></a>
        </section>

        <section class="middle tab-bar-section">
          <h1 class="title">Admin</h1>
        </section>

        <section class="right">
          <a href="/signout">Sign Out</a>
        </section>

      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Menu</label></li>
          <li><a href="/admin/dashboard">Book Categories</a></li>
          <li><a href="/admin/dashboard/logs">Logs</a></li>
          <li><a href="/admin/dashboard/borrowers">Borrowers</a></li>
          <li><a href="/admin/dashboard/borrowerreservelist">Borrowers Reserved List</a></li>
          <li><a href="/admin/dashboard/borrowerrequest">Borrower Requests</a></li>
        </ul>
      </aside>

        <!-- MODAL -->
        <div id="accept-modal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
            <p id="accept-test"></p>
            <form method="POST" action="/admin/dashboard/borrowerresponse">
                <div class="row">
                    <div class="large-12 columns">
                        <label>
                            <input type="hidden" value="" id="bookid" name="bookid" />
                            <input type="submit" class="button small info" value="Accept Request" />
                        </label>
                    </div>
                </div>
            </form>
            <a class="close-reveal-modal" aria-label="Close">&#215;</a>
        </div>

        <div id="decline-modal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
            <p id="decline-test"></p>
            <form method="POST" action="/admin/dashboard/borrwerdeleterequest">
                <div class="row">
                    <div class="large-12 columns">
                        <label>
                            <input type="hidden" value="" id="declinebookid" name="declinebookid" />
                            <input type="submit" class="button small info" value="Decline Request" />
                        </label>
                    </div>
                </div>
            </form>
            <a class="close-reveal-modal" aria-label="Close">&#215;</a>
        </div>
        <!-- END MODAL -->

      <section class="row" id="content-section">

        <nav class="breadcrumbs" style="margin-top: 10px" role="menubar" aria-label="breadcrumbs">
          <li role="menuitem"><a href="/admin/dashboard">Category</a></li>
          <li role="menuitem" class="current"><a href="#">Borrower Requests</a></li>
        </nav>

        <br />

        <div>

        <table id="borrowers_table" style="margin-top: 10px; width: 100%">
          <thead>
            <tr>
              <th style="text-align: center">Name</th>
              <th style="text-align: center">ISBN</th>
              <th style="text-align: center">Title</th>
              <th style="text-align: center">Author</th>
              <th style="text-align: center">Date</th>
              <th style="text-align: center">Action</th>
            </tr>
          </thead>
          <tbody>
             <% borrowerData.forEach(function(data, i) {%>
              <% if(data.status === "pending") { %>
                  <tr>
                    <td style="text-align: center" data-td="<%=data._id%>"><%= data.name %></td>
                    <td style="text-align: center"><%= data.isbn %></td>
                    <td style="text-align: center"><%= data.title %></td>
                    <td style="text-align: center"><%= data.author %></td>
                    <td style="text-align: center"><%= moment(data.added).format('llll') %></td>
                    <td style="text-align: center">
                      <p style="padding-top: 28px">
                         <i class="fi-save button tiny request-btn" data-reveal-id="accept-modal" id="<%= data._id %>" style="background-color: transparent; color: cornflowerblue; font-size: 24px"></i>
                         <i class="fi-trash button tiny decline-btn" data-reveal-id="decline-modal" data-decline="<%= data._id %>" style="background-color: transparent; color: red; font-size: 24px"></i>
                      </p>
                    </td>
                   </tr>
              <% } %>
            <% }); %>
          </tbody>
        </table>

        </div>


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

    <script type="text/javascript" src="/lib/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/lib/foundation/js/foundation.js"></script>
    <script type="text/javascript" src="/lib/datatable/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="/assets/js/datatable.js"></script>
    <script type="text/javascript" src="/assets/js/foundation.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            var userId = $('#userId').val();
            var children = "";

            var host = window.location.origin;
            $(".request-btn").click(function (e) {
                var productId = $(this).attr("id");
                console.log(productId);
                $('#bookid').val(productId);
                var username = "";

                var tdLength = document.getElementsByTagName("td");
//                console.log(tdLength);
                for(var td = 0; td < tdLength.length; td++) {
                    if($(tdLength[td]).attr("data-td") == productId) {
                        username = tdLength[td].textContent;
//                        console.log(tdLength[td]);
                        break;
                    }
                }

                $('#accept-test').html("Accept book request from <i style=\"color: orange\"> " + username+ "<i> ?");
            });

            $(".decline-btn").click(function (e) {
                var declineId = $(this).attr("data-decline");
                $('#declinebookid').val(declineId);
                var username = "";

                var tdLength = document.getElementsByTagName("td");
//                console.log(tdLength);
                for(var td = 0; td < tdLength.length; td++) {
                    if($(tdLength[td]).attr("data-td") == declineId) {
                        username = tdLength[td].textContent;
//                        console.log(tdLength[td]);
                        break;
                    }
                }

                $('#decline-test').html("Decline book request from <i style=\"color: orange\"> " + username+ "<i> ?");
            });
        });
    </script>
</body>
</html>
